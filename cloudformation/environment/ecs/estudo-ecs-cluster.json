{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Modelo de Cluster ECS",
    "Parameters": {
        "LoadBalancerName": {
            "Type": "String",
            "Description": "O nome do balanceador de carga. Este nome deve ser único por região por conta, pode ter no máximo 30 caracteres, deve conter apenas caracteres alfanuméricos ou hífens, não deve começar ou terminar com um hífen e não deve começar com \"internal-\", \"ic-\" ou \"sb-\".",
            "Default": "estudo-cluster"
        },
        "Environment": {
            "Type": "String",
            "Description": "Escolha o tipo de ambiente",
            "Default": "estudo",
            "AllowedValues": [
                "estudo"
            ]
        },
        "ClusterName": {
            "Type": "String",
            "Description": "Uma string gerada pelo usuário que você usa para identificar seu cluster. Não use o prefixo de ambiente e domínio no nome, pois eles serão incluídos automaticamente.",
            "Default": "cluster-estudo",
            "MinLength": 2,
            "MaxLength": 96
        },
        "ContainerInsights": {
            "Type": "String",
            "Description": "As informações de contêiner do CloudWatch serão habilitadas para o cluster, caso contrário, serão desabilitadas, a menos que a configuração da conta containerInsights esteja habilitada",
            "Default": "enabled",
            "AllowedValues": [
                "enabled",
                "disabled"
            ]
        }
    },
    "Metadata": {
        "AWS::CloudFormation::Interface": {
            "ParameterGroups": [
                {
                    "Label": {
                        "default": "Configuração do Cluster ECS"
                    },
                    "Parameters": [
                        "ClusterName",
                        "Environment",
                        "ContainerInsights"
                    ]
                }
            ],
            "ParameterLabels": {
                "ClusterName": {
                    "default": "Nome do Cluster"
                },
                "Environment": {
                    "default": "Tipo de Ambiente"
                },
                "ContainerInsights": {
                    "default": "Informações do Contêiner"
                }
            }
        }
    },
    "Mappings": {
        "EnvironmentMap": {
            "estudo": {
                "Prefix": "estudo"
            }
        },
        "DomainMap": {
            "celsotux": {
                "Prefix": "celsotux",
                "AccountId": "033795200546"
            }
        },
        "AccountMap": {
            "033795200546": {
                "Prefix": "celsotux",
                "Name": "celso-tux"
            }
        }
    },
    "Resources": {
        "ECSCluster": {
            "Type": "AWS::ECS::Cluster",
            "Properties": {
                "ClusterName": {
                    "Fn::Sub": [
                        "${Prefix}-${ClusterName}",
                        {
                            "Prefix": {
                                "Fn::FindInMap": [
                                    "EnvironmentMap",
                                    {
                                        "Ref": "Environment"
                                    },
                                    "Prefix"
                                ]
                            },
                            "ClusterName": {
                                "Ref": "ClusterName"
                            }
                        }
                    ]
                },
                "CapacityProviders": [
                    "FARGATE"
                ],
                "ClusterSettings": [
                    {
                        "Name": "containerInsights",
                        "Value": {
                            "Ref": "ContainerInsights"
                        }
                    }
                ],
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Sub": [
                                "${Prefix}-${ClusterName}",
                                {
                                    "Prefix": {
                                        "Fn::FindInMap": [
                                            "EnvironmentMap",
                                            {
                                                "Ref": "Environment"
                                            },
                                            "Prefix"
                                        ]
                                    },
                                    "ClusterName": {
                                        "Ref": "ClusterName"
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "Key": "Environment",
                        "Value": {
                            "Ref": "Environment"
                        }
                    },
                    {
                        "Key": "Domain",
                        "Value": {
                            "Fn::FindInMap": [
                                "AccountMap",
                                {
                                    "Ref": "AWS::AccountId"
                                },
                                "Name"
                            ]
                        }
                    }
                ]
            }
        }
    }
}
